<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <title>Contact-Book</title>
</head>

<body class="p-6 flex flex-col items-center">

<h1 class="text-4xl font-bold mb-6 text-center">Contact Book</h1>

<div class="w-full bg-white shadow-lg rounded-xl p-5 border border-gray-200">
  <form method="get" action="/" class="flex gap-2 w-full">

    <div class="relative flex-1">
      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-xl">
        <i class="fa-solid fa-magnifying-glass"></i>
      </span>

      <input 
        type="text" 
        name="search" 
        placeholder="Search by name..."
        class="w-full pl-10 px-3 py-3 border border-gray-300 rounded-lg bg-gray-100"
      />
    </div>

    <button
      type="submit"
      class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
      Search
    </button>

    <button type="button"
            onclick="openPopup(null)"
            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
      <i class="fa-solid fa-plus"></i> Add New Contact
    </button>

  </form>
</div>

<div class="w-full bg-white shadow-lg rounded-xl mt-6 border border-gray-200">
  <div class="grid grid-cols-6 font-semibold text-gray-700 bg-gray-100 py-3 px-4 border-b">
    <p>Name</p>
    <p>Username</p>
    <p>Phone</p>
    <p>Email</p>
    <p class="text-center col-span-2">Action</p>
  </div>

  <% allData.forEach(item => { %>
    <div class="grid grid-cols-6 py-3 px-4 border-b hover:bg-gray-50 items-center">

      <p><%= item.name %></p>
      <p><%= item.username %></p>
      <p><%= item.phone %></p>
      <p><%= item.email %></p>

      <div class="flex justify-center gap-4 col-span-2">

        <button 
          class="editBtn px-4 py-2 border border-blue-600 text-blue-600 rounded-md hover:bg-blue-600 hover:text-white transition"
          data-item='<%- JSON.stringify(item) %>'>
          <i class="fa-solid fa-pen-to-square text-xl"></i> Edit
        </button>

        <a href="/deleteData/<%= item._id %>"
           onclick="return confirm('Are you sure?')"
           class="px-4 py-2 border border-red-600 text-red-600 rounded-md hover:bg-red-600 hover:text-white transition">
          <i class="fa-solid fa-trash text-xl"></i> Delete
        </a>

      </div>

    </div>
  <% }) %>

  <% if (allData.length === 0) { %>
    <div class="flex flex-col items-center justify-center py-12">
      <i class="fa-solid fa-users text-6xl text-gray-400 mb-4"></i>
      <p class="text-xl text-gray-500 mb-4">No data available. Add some entries!</p>

      <button onclick="openPopup(null)"
              class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
        Add New Contact
      </button>
    </div>
  <% } %>
</div>

<!-- Popup -->
<div id="popupWrapper"
     class="fixed inset-0 bg-black/60 flex items-center justify-center hidden">

  <div class="bg-white w-full max-w-md rounded-xl shadow-xl p-6 relative">

    <button onclick="closePopup()"
            class="absolute top-3 right-3 text-gray-600 hover:text-black text-xl">
      âœ•
    </button>

    <h2 id="popupTitle" class="text-2xl font-bold mb-4">Add New Contact</h2>

    <form method="POST" action="/crudData" class="space-y-4">

      <input type="hidden" name="id" id="contactId" />

      <label class="font-semibold">Full Name*</label>
      <input type="text" name="name" id="name"
             class="w-full px-4 py-2 border rounded-lg" required>

      <label class="font-semibold">Username*</label>
      <input type="text" name="username" id="username"
             class="w-full px-4 py-2 border rounded-lg" required>

      <label class="font-semibold">Phone*</label>
      <input type="text" name="phone" id="phone"
             class="w-full px-4 py-2 border rounded-lg" required>

      <label class="font-semibold">Email*</label>
      <input type="email" name="email" id="email"
             class="w-full px-4 py-2 border rounded-lg" required>

      <div class="flex gap-3 pt-2">
        <button type="button"
                onclick="closePopup()"
                class="w-1/2 border border-gray-300 text-gray-600 py-2 rounded-lg font-semibold">
          Cancel
        </button>

        <button type="submit"
                class="w-1/2 bg-blue-600 text-white py-2 rounded-lg font-semibold">
          Save Contact
        </button>
      </div>

    </form>
  </div>
</div>

<script>
  // Handle Edit Button Click
  document.addEventListener("click", function (e) {
    if (e.target.closest(".editBtn")) {
      const btn = e.target.closest(".editBtn");
      const data = JSON.parse(btn.dataset.item);
      openPopup(data);
    }
  });

  function openPopup(data) {
    document.getElementById("popupWrapper").classList.remove("hidden");

    if (data) {
      document.getElementById("popupTitle").innerText = "Edit Contact";
      document.getElementById("contactId").value = data._id;
      document.getElementById("name").value = data.name;
      document.getElementById("username").value = data.username;
      document.getElementById("phone").value = data.phone;
      document.getElementById("email").value = data.email;
    } else {
      document.getElementById("popupTitle").innerText = "Add New Contact";
      document.getElementById("contactId").value = "";
      document.getElementById("name").value = "";
      document.getElementById("username").value = "";
      document.getElementById("phone").value = "";
      document.getElementById("email").value = "";
    }
  }

  function closePopup() {
    document.getElementById("popupWrapper").classList.add("hidden");
  }
</script>

</body>
</html>
